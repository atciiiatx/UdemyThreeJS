<html>

<head>
    <title>Loading Test</title>
    <link rel="stylesheet" href="three.js-master/test/benchmark/style.css">
    <script src="three.js-master/build/three.min.js"></script>
    <script src="three.js-master/examples/js/loaders/GLTFLoader.js"></script>
    <script src="three.js-master/examples/js/loaders/STLLoader.js"></script>
</head>

<body>
</body>

</html>

<script>
    let scene = null;
    let camera = null;
    let renderer = null;
    let model = null;
    let angInc = 0.02;

    let createSphere = function () {
        let geometry = new THREE.SphereGeometry(2, 32, 32, 0, Math.PI, Math.PI / 2);
        let material = new THREE.MeshBasicMaterial({ color: 0x00a1cb, wireframe: true });
        model = new THREE.Mesh(geometry, material);
        scene.add(sphere);
    };

    let loadGLTF = function () {
        let fileName = 'ape.glb';
        let loader = new THREE.GLTFLoader();
        if (loader != null) {
            loader.load(fileName,
                function (gltf) {
                    model = gltf.scene;
                    scene.add(model);
                    console.log(`Loaded ${fileName}`);
                }),
                undefined,
                function (err) {
                    console.log(`Error loading ${fileName}: ${err}`);
                }
        }
        else {
            console.log('Failed to create GLTF Loader');
        }
    }

    let loadSTL = function () {
        //let fileName = 'cube.stl';
        //let fileName = 'locatingFeature.stl';
        let fileName = 'trayModel.stl';
        let loader = new THREE.STLLoader();
        if (loader != null) {
            loader.load(fileName,
                function (geometry) {
                    let material = new THREE.MeshPhongMaterial({ color: 0xdddddd});
                    model = new THREE.Mesh(geometry, material);
                    scene.add(model);
                    console.log(`Loaded ${fileName}`);
                }),
                undefined,
                function (err) {
                    console.log(`Error loading ${fileName}: ${err}`);
                }
        }
        else {
            console.log('Failed to create STL Loader');
        }
    }

    // set up the environment - 
    // initiallize scene, camera, objects and renderer
    let init = function () {
        // create the scene
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xaabbcc);

        // create and locate the camera
        camera = new THREE.PerspectiveCamera(75,
            window.innerWidth / window.innerHeight,
            1, 1000);
        camera.position.set(0, 0, 40);

        // Lighting
        let ambientLight = new THREE.AmbientLight(0x606060);
        scene.add(ambientLight);
        let pointLight = new THREE.PointLight(0xffffff, 1, 100);
        pointLight.position.set(10, 10, 10);
        scene.add(pointLight);

        // Add geometry
        //createSphere();
        //loadGLTF();
        loadSTL();

        // create the renderer   
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);

        document.body.appendChild(renderer.domElement);

    };


    // main animation loop - calls every 50-60 ms.
    let mainLoop = function () {
        if (model != null) {
            model.rotation.y += angInc;
        }
        renderer.render(scene, camera);
        requestAnimationFrame(mainLoop);
    };

    ///////////////////////////////////////////////
    init();
    mainLoop();
</script>